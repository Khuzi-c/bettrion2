<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Hours - Bettrion Admin</title>
    <link rel="stylesheet" href="/assets/css/admin-v2.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>

<body>
    <main class="admin-main">
        <h1 class="page-title">Staff Time Logs</h1>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Clock In</th>
                        <th>Clock Out</th>
                        <th>Duration (Min)</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td colspan="4" style="text-align:center;">Loading logs...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/admin-v2.js"></script>
    <script>
        async function load() {
            try {
                const res = await api.get('/admin/staff-logs');
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';

                if (res.success && res.data.length > 0) {
                    res.data.forEach(log => {
                        const tr = document.createElement('tr');
                        const user = log.users ? log.users.email : 'Unknown';
                        const duration = log.duration_minutes ? Math.round(log.duration_minutes) : '-';
                        const isActive = !log.clock_out;

                        tr.innerHTML = `
                            <td><strong>${user}</strong></td>
                            <td>${new Date(log.clock_in).toLocaleString()}</td>
                            <td>${isActive ? '<span class="badge badge-active">ACTIVE</span>' : new Date(log.clock_out).toLocaleString()}</td>
                            <td>${isActive ? 'Running...' : duration + ' m'}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">No logs found.</td></tr>';
                }
            } catch (e) { console.error(e); }
        }
        window.addEventListener('load', load);
    </script>
</body>

</html>