<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Manage Translations - Bettrion Admin</title>
    <link rel="stylesheet" href="/assets/css/admin.css">
    <link rel="stylesheet" href="/assets/css/sidebar.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        .stats-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .action-btn {
            background: #e50914;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .action-btn:hover {
            background: #ff0f1f;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar-container"></aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h1>Translation Manager</h1>
                <div class="user-info">admin</div>
            </header>

            <div class="content-wrapper">
                <div class="stats-card">
                    <h2>Cache Statistics</h2>
                    <p id="stats-loading">Loading stats...</p>
                    <div id="stats-container" style="display:none;">
                        <p><strong>Total Cached Translations:</strong> <span id="total-count"
                                style="color:lime;font-size:1.5rem;">0</span></p>
                    </div>
                </div>

                <div class="card">
                    <h3>Actions</h3>
                    <p>Clear the translation cache to force re-translation of all content from external API.</p>
                    <button class="action-btn" onclick="clearCache()">⚠️ Clear Translation Cache</button>
                    <p id="msg" style="margin-top:10px;"></p>
                </div>
            </div>
        </main>
    </div>

    <script src="/assets/js/admin-sidebar.js"></script>
    <script src="/assets/js/utils.js"></script>
    <!-- api.js might not be included in admin-sidebar, so include utils first then manual fetch -->
    <script>
        document.addEventListener('DOMContentLoaded', loadStats);

        async function loadStats() {
            try {
                const res = await fetch('/api/admin/translations/stats');
                const data = await res.json();
                if (data.success) {
                    document.getElementById('stats-loading').style.display = 'none';
                    document.getElementById('stats-container').style.display = 'block';
                    document.getElementById('total-count').innerText = data.count;
                }
            } catch (err) {
                console.error(err);
                document.getElementById('stats-loading').innerText = 'Error loading stats.';
            }
        }

        async function clearCache() {
            if (!confirm('Are you sure? This will delete all cached translations and require API calls to re-generate them.')) return;

            const msg = document.getElementById('msg');
            msg.innerText = 'Clearing...';

            try {
                const res = await fetch('/api/admin/translations/clear', { method: 'POST' });
                const data = await res.json();
                if (data.success) {
                    msg.innerText = '✅ Cache cleared!';
                    msg.style.color = 'lime';
                    loadStats();
                } else {
                    msg.innerText = '❌ Error: ' + data.error;
                    msg.style.color = 'red';
                }
            } catch (err) {
                console.error(err);
                msg.innerText = '❌ Request failed';
            }
        }
    </script>
</body>

</html>